<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <title>Duty Planner - Work Hours</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; display: flex; height: 100vh; }
        #sidebar { width: 340px; background: #2c3e50; color: white; padding: 25px; box-shadow: 3px 0 10px rgba(0,0,0,0.2); overflow-y: auto; }
        #main { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd; box-sizing: border-box; }
        .staff-item { background: #1e272e; padding: 10px; margin-top: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #3498db; }
        .del-btn { color: #ff7675; cursor: pointer; border: none; background: none; font-weight: bold; font-size: 18px; }
        .stat-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; }
        .stat-badge { background: #fff; border: 1px solid #3498db; padding: 4px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { padding: 12px; border: 1px solid #dee2e6; text-align: left; }
        th { background: #3498db; color: white; }
        .month-header { background: #2c3e50; color: white; padding: 12px; font-weight: bold; margin-top: 25px; border-radius: 4px; }
        .draggable { cursor: grab; background: #e3f2fd; padding: 8px; border-radius: 6px; display: block; border: 1px solid #bbdefb; }
        .phone-text { display: block; font-size: 11px; color: #7f8c8d; }
        .hours-tag { font-size: 11px; background: #ffeaa7; color: #d35400; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-top: 4px; display: inline-block; }
        .weekend { background: #fff5f5; color: #e74c3c; font-weight: bold; }
        .btn { border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; color: white; }
        .btn-gen { background: #27ae60; }
        .btn-pdf { background: #e67e22; }
    </style>
</head>
<body>

<div id="sidebar">
    <h3>ğŸ“… áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ˜</h3>
    <input type="month" id="startMonth">
    <input type="month" id="endMonth">

    <h3>ğŸ‘¥ áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜</h3>
    <input type="text" id="staffName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
    <input type="text" id="staffPhone" placeholder="áƒœáƒáƒ›áƒ”áƒ áƒ˜" onkeypress="if(event.key==='Enter') addStaff()">
    <button class="btn btn-gen" onclick="addStaff()">áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
    <div id="staffListUI"></div>

    <button class="btn btn-gen" style="margin-top: 30px;" onclick="generateNew()">ğŸ”„ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ</button>
    <button class="btn btn-pdf" onclick="exportPDF()">ğŸ“„ PDF áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜</button>
</div>

<div id="main">
    <div class="card" id="printArea">
        <h2 id="mainTitle">áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜ áƒ“áƒ áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜</h2>
        <div id="statsUI" class="stat-container"></div>
        <div id="scheduleContainer"></div>
    </div>
</div>

<script>
    // áƒ•áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ— áƒ˜áƒ’áƒ˜áƒ•áƒ” áƒ’áƒáƒ¡áƒáƒ¦áƒ”áƒ‘áƒ”áƒ‘áƒ¡, áƒ áƒáƒª áƒ¬áƒ˜áƒœáƒ áƒ•áƒ”áƒ áƒ¡áƒ˜áƒáƒ¨áƒ˜, áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒ áƒáƒ› áƒáƒ  áƒ“áƒáƒ˜áƒ™áƒáƒ áƒ’áƒáƒ¡
    let staff = JSON.parse(localStorage.getItem('savedStaffContacts')) || [];
    let scheduleData = JSON.parse(localStorage.getItem('currentSchedule')) || [];

    window.onload = () => {
        const now = new Date();
        const monthStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
        document.getElementById('startMonth').value = localStorage.getItem('startMonth') || monthStr;
        document.getElementById('endMonth').value = localStorage.getItem('endMonth') || monthStr;
        renderStaff();
        if(scheduleData.length > 0) renderMultiTable();
    };

    function addStaff() {
        const n = document.getElementById('staffName'), p = document.getElementById('staffPhone');
        if(n.value.trim()) {
            staff.push({ name: n.value.trim(), phone: p.value.trim() || "---" });
            localStorage.setItem('savedStaffContacts', JSON.stringify(staff));
            n.value = ""; p.value = ""; n.focus();
            renderStaff();
        }
    }

    function removeStaff(i) {
        staff.splice(i, 1);
        localStorage.setItem('savedStaffContacts', JSON.stringify(staff));
        renderStaff();
    }

    function renderStaff() {
        document.getElementById('staffListUI').innerHTML = staff.map((s, i) => `
            <div class="staff-item">
                <div><b>${s.name}</b><br><small>${s.phone}</small></div>
                <button class="del-btn" onclick="removeStaff(${i})">Ã—</button>
            </div>`).join('');
    }

    function generateNew() {
        if(staff.length === 0) return alert("áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ— áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜!");
        const start = new Date(document.getElementById('startMonth').value);
        const end = new Date(document.getElementById('endMonth').value);
        localStorage.setItem('startMonth', document.getElementById('startMonth').value);
        localStorage.setItem('endMonth', document.getElementById('endMonth').value);
        
        scheduleData = [];
        let temp = new Date(start.getFullYear(), start.getMonth(), 1);
        let idx = 0;
        while(temp <= new Date(end.getFullYear(), end.getMonth() + 1, 0)) {
            scheduleData.push({ 
                date: new Date(temp), 
                staffName: staff[idx % staff.length].name, 
                staffPhone: staff[idx % staff.length].phone 
            });
            idx++; temp.setDate(temp.getDate() + 1);
        }
        localStorage.setItem('currentSchedule', JSON.stringify(scheduleData));
        renderMultiTable();
    }

    function renderMultiTable() {
        const container = document.getElementById('scheduleContainer');
        container.innerHTML = "";
        let currentMonth = -1;
        let currentBody;
        const months = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];
        const days = ["áƒ™áƒ•áƒ˜áƒ áƒ", "áƒáƒ áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒ¡áƒáƒ›áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒáƒ—áƒ®áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒ®áƒ£áƒ—áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒáƒáƒ áƒáƒ¡áƒ™áƒ”áƒ•áƒ˜", "áƒ¨áƒáƒ‘áƒáƒ—áƒ˜"];

        scheduleData.forEach((item, i) => {
            const d = new Date(item.date);
            if(d.getMonth() !== currentMonth) {
                currentMonth = d.getMonth();
                container.innerHTML += `<div class="month-header">${months[currentMonth]} ${d.getFullYear()}</div>`;
                const table = document.createElement('table');
                table.innerHTML = `<thead><tr><th>áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜</th><th>áƒ“áƒ¦áƒ”</th><th>áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜</th><th>áƒ›áƒáƒ áƒ˜áƒ’áƒ”</th></tr></thead><tbody id="body-${currentMonth}"></tbody>`;
                container.appendChild(table);
                currentBody = document.getElementById(`body-${currentMonth}`);
            }
            
            const isWE = d.getDay() === 0 || d.getDay() === 6;
            // áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒáƒ’áƒ˜áƒ™áƒ: áƒ¨áƒáƒ‘áƒáƒ—-áƒ™áƒ•áƒ˜áƒ áƒ 08:00, áƒ¡áƒ®áƒ•áƒ áƒ“áƒ¦áƒ”áƒ”áƒ‘áƒ˜ 18:00
            const workHours = isWE ? "08:00 - 03:00" : "18:00 - 03:00";

            currentBody.innerHTML += `<tr class="${isWE ? 'weekend' : ''}">
                <td>${d.getDate()} ${months[currentMonth].substring(0,3)}</td>
                <td>${days[d.getDay()]}</td>
                <td><span class="hours-tag">${workHours}</span></td>
                <td ondrop="drop(event, ${i})" ondragover="allowDrop(event)">
                    <span class="draggable" draggable="true" ondragstart="drag(event, ${i})" ondblclick="editCell(${i})">
                        ${item.staffName} <span class="phone-text">${item.staffPhone}</span>
                    </span>
                </td></tr>`;
        });
        updateStats();
    }

    function updateStats() {
        const c = {};
        scheduleData.forEach(item => c[item.staffName] = (c[item.staffName] || 0) + 1);
        document.getElementById('statsUI').innerHTML = Object.entries(c).map(([n, count]) => `<div class="stat-badge">${n}: ${count} áƒ“áƒ¦áƒ”</div>`).join('');
    }

    function editCell(i) {
        const n = prompt("áƒ¡áƒáƒ®áƒ”áƒšáƒ˜:", scheduleData[i].staffName);
        if(n) {
            scheduleData[i].staffName = n;
            scheduleData[i].staffPhone = prompt("áƒœáƒáƒ›áƒ”áƒ áƒ˜:", scheduleData[i].staffPhone) || "";
            localStorage.setItem('currentSchedule', JSON.stringify(scheduleData));
            renderMultiTable();
        }
    }

    function drag(ev, i) { ev.dataTransfer.setData("idx", i); }
    function allowDrop(ev) { ev.preventDefault(); }
    function drop(ev, to) {
        ev.preventDefault();
        const from = ev.dataTransfer.getData("idx");
        [scheduleData[from].staffName, scheduleData[to].staffName] = [scheduleData[to].staffName, scheduleData[from].staffName];
        [scheduleData[from].staffPhone, scheduleData[to].staffPhone] = [scheduleData[to].staffPhone, scheduleData[from].staffPhone];
        localStorage.setItem('currentSchedule', JSON.stringify(scheduleData));
        renderMultiTable();
    }

    async function exportPDF() {
        const { jsPDF } = window.jspdf;
        const canvas = await html2canvas(document.getElementById('printArea'), { scale: 1.5 });
        const pdf = new jsPDF('p', 'mm', 'a4');
        pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 10, 10, 190, 0);
        pdf.save("Work_Schedule_Hours.pdf");
    }
</script>
</body>
</html><!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <title>Duty Planner - Work Hours</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; display: flex; height: 100vh; }
        #sidebar { width: 340px; background: #2c3e50; color: white; padding: 25px; box-shadow: 3px 0 10px rgba(0,0,0,0.2); overflow-y: auto; }
        #main { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd; box-sizing: border-box; }
        .staff-item { background: #1e272e; padding: 10px; margin-top: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #3498db; }
        .del-btn { color: #ff7675; cursor: pointer; border: none; background: none; font-weight: bold; font-size: 18px; }
        .stat-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; }
        .stat-badge { background: #fff; border: 1px solid #3498db; padding: 4px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { padding: 12px; border: 1px solid #dee2e6; text-align: left; }
        th { background: #3498db; color: white; }
        .month-header { background: #2c3e50; color: white; padding: 12px; font-weight: bold; margin-top: 25px; border-radius: 4px; }
        .draggable { cursor: grab; background: #e3f2fd; padding: 8px; border-radius: 6px; display: block; border: 1px solid #bbdefb; }
        .phone-text { display: block; font-size: 11px; color: #7f8c8d; }
        .hours-tag { font-size: 11px; background: #ffeaa7; color: #d35400; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-top: 4px; display: inline-block; }
        .weekend { background: #fff5f5; color: #e74c3c; font-weight: bold; }
        .btn { border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; color: white; }
        .btn-gen { background: #27ae60; }
        .btn-pdf { background: #e67e22; }
    </style>
</head>
<body>

<div id="sidebar">
    <h3>ğŸ“… áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ˜</h3>
    <input type="month" id="startMonth">
    <input type="month" id="endMonth">

    <h3>ğŸ‘¥ áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜</h3>
    <input type="text" id="staffName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
    <input type="text" id="staffPhone" placeholder="áƒœáƒáƒ›áƒ”áƒ áƒ˜" onkeypress="if(event.key==='Enter') addStaff()">
    <button class="btn btn-gen" onclick="addStaff()">áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
    <div id="staffListUI"></div>

    <button class="btn btn-gen" style="margin-top: 30px;" onclick="generateNew()">ğŸ”„ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ</button>
    <button class="btn btn-pdf" onclick="exportPDF()">ğŸ“„ PDF áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜</button>
</div>

<div id="main">
    <div class="card" id="printArea">
        <h2 id="mainTitle">áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜ áƒ“áƒ áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜</h2>
        <div id="statsUI" class="stat-container"></div>
        <div id="scheduleContainer"></div>
    </div>
</div>

<script>
    // áƒ•áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ— áƒ˜áƒ’áƒ˜áƒ•áƒ” áƒ’áƒáƒ¡áƒáƒ¦áƒ”áƒ‘áƒ”áƒ‘áƒ¡, áƒ áƒáƒª áƒ¬áƒ˜áƒœáƒ áƒ•áƒ”áƒ áƒ¡áƒ˜áƒáƒ¨áƒ˜, áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ áƒ áƒáƒ› áƒáƒ  áƒ“áƒáƒ˜áƒ™áƒáƒ áƒ’áƒáƒ¡
    let staff = JSON.parse(localStorage.getItem('savedStaffContacts')) || [];
    let scheduleData = JSON.parse(localStorage.getItem('currentSchedule')) || [];

    window.onload = () => {
        const now = new Date();
        const monthStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
        document.getElementById('startMonth').value = localStorage.getItem('startMonth') || monthStr;
        document.getElementById('endMonth').value = localStorage.getItem('endMonth') || monthStr;
        renderStaff();
        if(scheduleData.length > 0) renderMultiTable();
    };

    function addStaff() {
        const n = document.getElementById('staffName'), p = document.getElementById('staffPhone');
        if(n.value.trim()) {
            staff.push({ name: n.value.trim(), phone: p.value.trim() || "---" });
            localStorage.setItem('savedStaffContacts', JSON.stringify(staff));
            n.value = ""; p.value = ""; n.focus();
            renderStaff();
        }
    }

    function removeStaff(i) {
        staff.splice(i, 1);
        localStorage.setItem('savedStaffContacts', JSON.stringify(staff));
        renderStaff();
    }

    function renderStaff() {
        document.getElementById('staffListUI').innerHTML = staff.map((s, i) => `
            <div class="staff-item">
                <div><b>${s.name}</b><br><small>${s.phone}</small></div>
                <button class="del-btn" onclick="removeStaff(${i})">Ã—</button>
            </div>`).join('');
    }

    function generateNew() {
        if(staff.length === 0) return alert("áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ— áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜!");
        const start = new Date(document.getElementById('startMonth').value);
        const end = new Date(document.getElementById('endMonth').value);
        localStorage.setItem('startMonth', document.getElementById('startMonth').value);
        localStorage.setItem('endMonth', document.getElementById('endMonth').value);
        
        scheduleData = [];
        let temp = new Date(start.getFullYear(), start.getMonth(), 1);
        let idx = 0;
        while(temp <= new Date(end.getFullYear(), end.getMonth() + 1, 0)) {
            scheduleData.push({ 
                date: new Date(temp), 
                staffName: staff[idx % staff.length].name, 
                staffPhone: staff[idx % staff.length].phone 
            });
            idx++; temp.setDate(temp.getDate() + 1);
        }
        localStorage.setItem('currentSchedule', JSON.stringify(scheduleData));
        renderMultiTable();
    }

    function renderMultiTable() {
        const container = document.getElementById('scheduleContainer');
        container.innerHTML = "";
        let currentMonth = -1;
        let currentBody;
        const months = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];
        const days = ["áƒ™áƒ•áƒ˜áƒ áƒ", "áƒáƒ áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒ¡áƒáƒ›áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒáƒ—áƒ®áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒ®áƒ£áƒ—áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒáƒáƒ áƒáƒ¡áƒ™áƒ”áƒ•áƒ˜", "áƒ¨áƒáƒ‘áƒáƒ—áƒ˜"];

        scheduleData.forEach((item, i) => {
            const d = new Date(item.date);
            if(d.getMonth() !== currentMonth) {
                currentMonth = d.getMonth();
                container.innerHTML += `<div class="month-header">${months[currentMonth]} ${d.getFullYear()}</div>`;
                const table = document.createElement('table');
                table.innerHTML = `<thead><tr><th>áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜</th><th>áƒ“áƒ¦áƒ”</th><th>áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜</th><th>áƒ›áƒáƒ áƒ˜áƒ’áƒ”</th></tr></thead><tbody id="body-${currentMonth}"></tbody>`;
                container.appendChild(table);
                currentBody = document.getElementById(`body-${currentMonth}`);
            }
            
            const isWE = d.getDay() === 0 || d.getDay() === 6;
            // áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒáƒ’áƒ˜áƒ™áƒ: áƒ¨áƒáƒ‘áƒáƒ—-áƒ™áƒ•áƒ˜áƒ áƒ 08:00, áƒ¡áƒ®áƒ•áƒ áƒ“áƒ¦áƒ”áƒ”áƒ‘áƒ˜ 18:00
            const workHours = isWE ? "08:00 - 03:00" : "18:00 - 03:00";

            currentBody.innerHTML += `<tr class="${isWE ? 'weekend' : ''}">
                <td>${d.getDate()} ${months[currentMonth].substring(0,3)}</td>
                <td>${days[d.getDay()]}</td>
                <td><span class="hours-tag">${workHours}</span></td>
                <td ondrop="drop(event, ${i})" ondragover="allowDrop(event)">
                    <span class="draggable" draggable="true" ondragstart="drag(event, ${i})" ondblclick="editCell(${i})">
                        ${item.staffName} <span class="phone-text">${item.staffPhone}</span>
                    </span>
                </td></tr>`;
        });
        updateStats();
    }

    function updateStats() {
        const c = {};
        scheduleData.forEach(item => c[item.staffName] = (c[item.staffName] || 0) + 1);
        document.getElementById('statsUI').innerHTML = Object.entries(c).map(([n, count]) => `<div class="stat-badge">${n}: ${count} áƒ“áƒ¦áƒ”</div>`).join('');
    }

    function editCell(i) {
        const n = prompt("áƒ¡áƒáƒ®áƒ”áƒšáƒ˜:", scheduleData[i].staffName);
        if(n) {
            scheduleData[i].staffName = n;
            scheduleData[i].staffPhone = prompt("áƒœáƒáƒ›áƒ”áƒ áƒ˜:", scheduleData[i].staffPhone) || "";
            localStorage.setItem('currentSchedule', JSON.stringify(scheduleData));
            renderMultiTable();
        }
    }

    function drag(ev, i) { ev.dataTransfer.setData("idx", i); }
    function allowDrop(ev) { ev.preventDefault(); }
    function drop(ev, to) {
        ev.preventDefault();
        const from = ev.dataTransfer.getData("idx");
        [scheduleData[from].staffName, scheduleData[to].staffName] = [scheduleData[to].staffName, scheduleData[from].staffName];
        [scheduleData[from].staffPhone, scheduleData[to].staffPhone] = [scheduleData[to].staffPhone, scheduleData[from].staffPhone];
        localStorage.setItem('currentSchedule', JSON.stringify(scheduleData));
        renderMultiTable();
    }

    async function exportPDF() {
        const { jsPDF } = window.jspdf;
        const canvas = await html2canvas(document.getElementById('printArea'), { scale: 1.5 });
        const pdf = new jsPDF('p', 'mm', 'a4');
        pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 10, 10, 190, 0);
        pdf.save("Work_Schedule_Hours.pdf");
    }
</script>
</body>
</html>
